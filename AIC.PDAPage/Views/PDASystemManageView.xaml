<UserControl x:Class="AIC.PDAPage.Views.PDASystemManageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:control="clr-namespace:AIC.Core.OrganizationModels;assembly=AIC.Core"
             xmlns:model="clr-namespace:AIC.PDAPage.Models"
             xmlns:local="clr-namespace:AIC.PDAPage.Views"
             xmlns:convert="clr-namespace:AIC.PDAPage.Converters"
             xmlns:prism="http://prismlibrary.com/"      
             xmlns:command="clr-namespace:AIC.Core.ExCommand;assembly=AIC.Core"              
             prism:ViewModelLocator.AutoWireViewModel="True"              
             Style="{DynamicResource AsyncWorkUserControlStyle}"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <convert:BoolVisibilityConverter x:Key="boolVisibilityConverter"/>
                    <convert:IntAdd1Converter x:Key="intAdd1Converter"/>
                    <command:CommandReference x:Key="AddCommandReference" Command="{Binding AddCommand}"/>
                    <command:CommandReference x:Key="AddRootCommandReference" Command="{Binding AddRootCommand}"/>
                    <command:CommandReference x:Key="SortCommandReference" Command="{Binding SortCommand}"/>
                    <command:CommandReference x:Key="AddOrganizationReference" Command="{Binding AddOrganizationCommand}"/>
                    <command:CommandReference x:Key="DeleteCommandReference" Command="{Binding DeleteCommand}"/>
                    <command:CommandReference x:Key="CopyCommandReference" Command="{Binding CopyCommand}"/>
                    <command:CommandReference x:Key="PasteCommandReference" Command="{Binding PasteCommand}"/>
                    <command:CommandReference x:Key="PasteRootCommandReference" Command="{Binding PasteRootCommand}"/>
                    <command:CommandReference x:Key="RenameCommandReference" Command="{Binding RenameCommand}"/>
                    <command:CommandReference x:Key="DeleteCardCommandReference" Command="{Binding DeleteCardCommand}"/>
                    <command:CommandReference x:Key="ForceDeleteCardCommandReference" Command="{Binding ForceDeleteCardCommand}"/>
                    <command:CommandReference x:Key="ClearRecycledCommandReference" Command="{Binding ClearRecycledCommand}"/>
                    <command:CommandReference x:Key="RecoveredItemCommandReference" Command="{Binding RecoveredItemCommand}"/>
                    <command:CommandReference x:Key="DebugCommandReference" Command="{Binding DebugCommand}"/>
                    <command:CommandReference x:Key="EditDeviceCommandReference" Command="{Binding EditDeviceCommand}"/>
                    <Style x:Key="RadioButtonStyle" TargetType="{x:Type RadioButton}">
                        <!--<Setter Property="Foreground" Value="{DynamicResource AccentColorBrush}"/>-->
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource AccentColorBrush}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type RadioButton}">
                                    <ControlTemplate.Resources>
                                        <Storyboard x:Key="OnLoaded1">
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)" Storyboard.TargetName="grid">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
                                            </DoubleAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)" Storyboard.TargetName="grid">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </ControlTemplate.Resources>
                                    <!-- BulletDecorator is used to provide baseline alignment between the checkmark and the Content -->
                                    <BulletDecorator Background="Transparent">
                                        <BulletDecorator.Bullet>
                                            <Grid x:Name="grid" Width="24" Height="24" RenderTransformOrigin="0.5,0.5">
                                                <Grid.RenderTransform>
                                                    <TransformGroup>
                                                        <ScaleTransform/>
                                                        <SkewTransform/>
                                                        <RotateTransform/>
                                                        <TranslateTransform/>
                                                    </TransformGroup>
                                                </Grid.RenderTransform>
                                                <Ellipse x:Name="Ellipse_Border" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="3"/>
                                                <Ellipse Margin="5" x:Name="CheckMark" Fill="{DynamicResource AccentColorBrush}"/>
                                            </Grid>
                                        </BulletDecorator.Bullet>
                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" RecognizesAccessKey="True"/>
                                    </BulletDecorator>

                                    <ControlTemplate.Triggers>
                                        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                            <BeginStoryboard Storyboard="{StaticResource OnLoaded1}"/>
                                        </EventTrigger>
                                        <Trigger Property="IsChecked" Value="false">
                                            <Setter Property="Visibility" Value="Collapsed" TargetName="CheckMark"/>
                                        </Trigger>

                                        <Trigger Property="IsEnabled" Value="false">
                                            <Setter Property="Fill" Value="{DynamicResource DisabledBackgroundBrush}" TargetName="Ellipse_Border"/>
                                            <Setter Property="Stroke" Value="#40000000" TargetName="Ellipse_Border"/>
                                            <Setter Property="Foreground" Value="#80000000"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ResourceDictionary>
                <ResourceDictionary Source="/AIC.PDAPage;component/Themes/PDASystemManageTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <!--<UserControl.InputBindings>
        <KeyBinding Gesture="Control+Alt+S" Command="{Binding ShowDebugCommand}" />
    </UserControl.InputBindings>-->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="10*"/>
            <ColumnDefinition Width="4*"/>
            <ColumnDefinition Width="5*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.ColumnSpan="7" Orientation="Horizontal" >
            <TextBlock Text="{DynamicResource serverIP}" Margin="4,0,0,0" VerticalAlignment="Center"/>
            <!--<TextBox Text="{Binding ServerIP}" Style="{DynamicResource MetroTextBox}" Margin="4,0,0,0" Width="200" VerticalAlignment="Center" IsReadOnly="True"/>-->
            <ComboBox Width="200" ItemsSource="{Binding ServerIPCategory}" SelectedItem="{Binding ServerIP}" Style="{DynamicResource VirtualisedMetroComboBox}" VerticalAlignment="Center" IsEditable="False" Margin="4,0,0,0"/>
            <Button Command="{Binding UploadDateBaseCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  Visibility="Collapsed">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/database_go.png"  />
                        <TextBlock Text="{DynamicResource upload}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Command="{Binding RefreshDateBaseCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  Visibility="Collapsed">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/database_refresh.png"  />
                        <TextBlock Text="{DynamicResource refresh}" VerticalAlignment="Center" />
                    </StackPanel>
                </Button.Content>
            </Button>
            <TextBlock Text="{DynamicResource pdaip}" Margin="4,0,0,0" VerticalAlignment="Center"/>
            <TextBox x:Name="txtMainCardIP" Style="{DynamicResource MetroTextBox}" Margin="4,0,0,0" Width="200" VerticalAlignment="Center"
                Text="{Binding MainControlCardIPEdit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True, ValidatesOnDataErrors=True, NotifyOnValidationError=True}">
            </TextBox>
            <Button Command="{Binding AddCardCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  >
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/add.png"  />
                        <TextBlock Text="{DynamicResource add}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Command="{Binding DeleteCardCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  >
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/delete3.png"  />
                        <TextBlock Text="{DynamicResource delete}" VerticalAlignment="Center" />
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Command="{Binding DownLoadCardCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  >
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/tick.png"  />
                        <TextBlock Text="{DynamicResource senddown}" VerticalAlignment="Center" />
                    </StackPanel>
                </Button.Content>
            </Button>
            <TextBlock Text="{DynamicResource transmissionIdentifier}" Margin="4,0,0,0" VerticalAlignment="Center"/>
            <TextBox Text="{Binding TransmissionCardIdentifier}" Style="{DynamicResource MetroTextBox}" Margin="4,0,0,0" Width="200" VerticalAlignment="Center"/>
            <Button Command="{Binding AddTransmissionCardCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  >
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/add.png"  />
                        <TextBlock Text="{DynamicResource add}" VerticalAlignment="Center" />
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Command="{Binding DeleteTransmissionCardCommand}" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="4,0,0,0"  >
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Image Stretch="None" Source="/AIC.Resources;component/Images/delete3.png"  />
                        <TextBlock Text="{DynamicResource delete}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button.Content>
            </Button>
            <!--<StackPanel Visibility="{Binding IsShowDebug,Converter={StaticResource boolVisibilityConverter}}" Orientation="Horizontal">
                <TextBlock Text="组织机构Guid（调试使用）" Margin="4,0,0,0" VerticalAlignment="Center"/>
                <TextBox DataContext="{Binding ElementName=treeview, Path=SelectedItem}" Text="{Binding Path=T_Organization.Guid}" Margin="4,0,0,0" Style="{DynamicResource MetroTextBox}" Width="200" VerticalAlignment="Center" IsReadOnly="True"/>
                <TextBlock Text="组织机构父Guid（调试使用）" Margin="4,0,0,0" VerticalAlignment="Center"/>
                <TextBox DataContext="{Binding ElementName=treeview, Path=SelectedItem}" Text="{Binding Path=T_Organization.Parent_Guid}" Margin="4,0,0,0" Style="{DynamicResource MetroTextBox}" Width="200" VerticalAlignment="Center" IsReadOnly="True"/>
                <TextBlock Text="回收站组织机构Guid（调试使用）" Margin="4,0,0,0" VerticalAlignment="Center"/>
                <TextBox DataContext="{Binding ElementName=treeview2, Path=SelectedItem}" Text="{Binding Path=T_Organization.Guid}" Margin="4,0,0,0" Style="{DynamicResource MetroTextBox}" Width="200" VerticalAlignment="Center" IsReadOnly="True"/>
            </StackPanel>-->
        </StackPanel>

        <StackPanel Grid.Row="0" Grid.ColumnSpan="7" Orientation="Horizontal" HorizontalAlignment="Right">
            <RadioButton Margin="5,0" Content="单槽显示" IsChecked="True" Style="{StaticResource RadioButtonStyle}"/>
            <RadioButton Content="多槽显示" IsChecked="{Binding IsMultiSelected}"  Style="{StaticResource RadioButtonStyle}"/>
        </StackPanel>
        
        <Grid x:Name="grid1" Grid.Column="0" Grid.Row="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="3*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>
                <TreeView Name="treeview"                        
                        ItemsSource="{Binding OrganizationTreeItems}" 
                        Style="{DynamicResource VirtualisedMetroTreeView}"   
                        AllowDrop="{Binding AllowDropTree}"
                       >
                    <TreeView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="新建机构" Command="{StaticResource AddRootCommandReference}" CommandParameter="-1"/>
                            <MenuItem Header="粘贴机构" Command="{StaticResource PasteRootCommandReference}" CommandParameter="-1"/>
                        </ContextMenu>
                    </TreeView.ContextMenu>
                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type control:OrganizationTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="添加机构" Command="{StaticResource AddOrganizationReference}" 
                                            CommandParameter="{Binding}"/>                                       
                                        <MenuItem Header="添加设备" Command="{StaticResource AddCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="排序" Command="{StaticResource SortCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="删除机构" Command="{StaticResource DeleteCommandReference}" 
                                            CommandParameter="{Binding}" />
                                        <MenuItem Header="复制" Command="{StaticResource CopyCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="粘贴" Command="{StaticResource PasteCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="重命名" Command="{StaticResource RenameCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <!--<MenuItem Header="调试信息" Command="{StaticResource DebugCommandReference}" 
                                            CommandParameter="{Binding}" Visibility="Visible"/>-->
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <Path x:Name="IconPath" Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 24.0033,56.0078L 24.0033,38.0053L 22.0031,40.0056L 19.0027,35.0049L 38.0053,20.0028L 45.0063,25.5299L 45.0063,21.753L 49.0068,21.0029L 49.0068,28.6882L 57.008,35.0049L 54.0075,40.0056L 52.0073,38.0053L 52.0073,56.0078L 24.0033,56.0078 Z M 38.0053,26.9204L 27.0038,36.005L 27.0038,53.0074L 33.0046,53.0074L 33.0046,42.006L 43.006,42.006L 43.006,53.0074L 49.0068,53.0074L 49.0068,36.005L 38.0053,26.9204 Z "/>
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}" Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=false}"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=true}">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Enter" />
                                            <KeyBinding Key="Esc" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Esc" />
                                        </TextBox.InputBindings>
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Visibility,ElementName=renametextbox}" Value="Visible">
                                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=renametextbox}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="LostFocus">
                                                <i:InvokeCommandAction Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="LostFocus" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Grid>
                            </StackPanel>
                            <HierarchicalDataTemplate.Triggers>
                                <DataTrigger Binding="{Binding T_Organization.Level}" Value="0">
                                    <Setter TargetName="IconPath" Property="Data" Value="F1 M 28.5,20.5833L 47.5,20.5833L 47.5,23.75L 28.5,23.75L 28.5,20.5833 Z M 49.0833,31.6667L 64.9166,31.6667L 64.9166,34.8334L 49.0833,34.8334L 49.0833,31.6667 Z M 28.5,25.3334L 34.8333,25.3334L 41.1666,25.3334L 47.5,25.3334L 47.5,52.25L 41.1666,52.25L 41.1666,42.75L 34.8333,42.75L 34.8333,52.25L 28.5,52.25L 28.5,25.3334 Z M 49.0833,52.25L 49.0833,36.4167L 53.8333,36.4167L 60.1666,36.4167L 64.9166,36.4167L 64.9166,52.25L 60.1666,52.25L 60.1666,44.3333L 53.8333,44.3333L 53.8333,52.25L 49.0833,52.25 Z M 11.0833,52.25L 11.0833,44.3333L 11.0833,41.1667L 19.7917,34.8334L 26.9167,41.1667L 26.9167,44.3333L 26.9167,52.25L 22.1667,52.25L 22.1667,44.3333L 15.8333,44.3333L 15.8333,52.25L 11.0833,52.25 Z M 19.7916,29.6875L 26.9166,36.0209L 26.9166,39.1875L 19.7916,32.8542L 9.49999,40.375L 9.49999,37.2084L 19.7916,29.6875 Z "/>
                                    <Setter TargetName="IconPath" Property="Width" Value="24"/>
                                </DataTrigger>                             
                            </HierarchicalDataTemplate.Triggers>
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type control:DeviceTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="添加测点" Command="{StaticResource AddCommandReference}" 
                                                      CommandParameter="{Binding}"/>
                                        <MenuItem Header="排序" Command="{StaticResource SortCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="删除设备" Command="{StaticResource DeleteCommandReference}" 
                                                      CommandParameter="{Binding}" />
                                        <MenuItem Header="编辑设备" Command="{StaticResource EditDeviceCommandReference}" 
                                                      CommandParameter="{Binding}" />
                                        <MenuItem Header="复制" Command="{StaticResource CopyCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="粘贴" Command="{StaticResource PasteCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="重命名" Command="{StaticResource RenameCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <!--<MenuItem Header="调试信息" Command="{StaticResource DebugCommandReference}" 
                                            CommandParameter="{Binding}" Visibility="Visible"/>-->
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 24.69,17.5542L 27.9094,14.793C 28.5138,15.05 29.0876,15.3647 29.6241,15.7302L 29.0458,19.93L 33.2747,20.2541C 33.5166,20.8524 33.7023,21.4794 33.8252,22.1286L 30.4458,24.69L 33.207,27.9094C 32.95,28.5137 32.6353,29.0876 32.2698,29.6241L 28.07,29.0458L 27.7459,33.2747C 27.1476,33.5166 26.5206,33.7023 25.8714,33.8252L 23.3099,30.4458L 20.0906,33.207C 19.4862,32.95 18.9124,32.6353 18.3759,32.2698L 18.9542,28.0699L 14.7253,27.7459C 14.4834,27.1476 14.2977,26.5206 14.1748,25.8713L 17.5542,23.3099L 14.793,20.0906C 15.05,19.4862 15.3647,18.9124 15.7302,18.3759L 19.93,18.9542L 20.2541,14.7252C 20.8524,14.4834 21.4794,14.2977 22.1286,14.1748L 24.69,17.5542 Z M 24,20C 21.7909,20 20,21.7909 20,24C 20,26.2091 21.7909,28 24,28C 26.2091,28 28,26.2091 28,24C 28,21.7909 26.2091,20 24,20 Z " />
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}" Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=false}"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=true}">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Enter" />
                                            <KeyBinding Key="Esc" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Esc" />
                                        </TextBox.InputBindings>
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Visibility,ElementName=renametextbox}" Value="Visible">
                                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=renametextbox}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="LostFocus">
                                                <i:InvokeCommandAction Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="LostFocus" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Grid>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type control:ItemTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <!--<MenuItem Header="添加分频" Command="{StaticResource AddCommandReference}" 
                                                      CommandParameter="{Binding}"/>-->
                                        <MenuItem Header="排序" Command="{StaticResource SortCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="删除测点" Command="{StaticResource DeleteCommandReference}" 
                                                      CommandParameter="{Binding}" />
                                        <MenuItem Header="复制" Command="{StaticResource CopyCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="粘贴" Command="{StaticResource PasteCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="重命名" Command="{StaticResource RenameCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <!--<MenuItem Header="调试信息" Command="{StaticResource DebugCommandReference}" 
                                            CommandParameter="{Binding}" Visibility="Visible"/>-->
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 11,12L 13,12L 13,34L 37,34L 37,36L 11,36L 11,12 Z M 14,33L 14,30L 20,23L 29,27L 37,13L 37,17L 30,30L 20,26L 14,33 Z " />
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}" Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=false}"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=true}">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Enter" />
                                            <KeyBinding Key="Esc" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Esc" />
                                        </TextBox.InputBindings>
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Visibility,ElementName=renametextbox}" Value="Visible">
                                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=renametextbox}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="LostFocus">
                                                <i:InvokeCommandAction Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="LostFocus" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Grid>
                                <TextBlock Text="{Binding Error}" Margin="2,0,2,0"/>
                                <Path x:Name="StatusPath" Grid.Column="2" Width="16" Height="16" Stretch="Fill" Fill="Green" Data="F1 M 14.002,23.0031L 16.0021,23.0031L 16.0021,20.0028C 16.0021,15.5839 19.5843,12.0017 24.0032,12.0017C 28.4221,12.0017 32.0043,15.5839 32.0043,20.0028L 29.0039,20.0028C 29.0039,17.241 26.765,15.0021 24.0032,15.0021C 21.2414,15.0021 19.0025,17.241 19.0025,20.0028L 19.0025,23.0031L 34.0047,23.0031L 34.0047,36.005L 14.002,36.005L 14.002,23.0031 Z " />
                            </StackPanel>
                            <HierarchicalDataTemplate.Triggers>
                                <DataTrigger Binding="{Binding IsPaired}" Value="True">
                                    <Setter TargetName="StatusPath" Property="Data" Value="F1 M 14.0021,23.0031L 16.0022,23.0031L 16.0022,20.0028C 16.0022,15.5839 19.5845,12.0017 24.0033,12.0017C 28.4222,12.0017 32.0045,15.5839 32.0045,20.0028L 32.0045,23.0031L 34.0049,23.0031L 34.0049,36.005L 14.0021,36.005L 14.0021,23.0031 Z M 29.004,20.0028C 29.004,17.241 26.7652,15.0021 24.0033,15.0021C 21.2415,15.0021 19.0026,17.241 19.0026,20.0028L 19.0026,23.0031L 29.004,23.0031L 29.004,20.0028 Z " />
                                    <Setter TargetName="StatusPath" Property="Fill" Value="Red" />
                                </DataTrigger>
                            </HierarchicalDataTemplate.Triggers>
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type control:DivFreTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="排序" Command="{StaticResource SortCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="删除分频" Command="{StaticResource DeleteCommandReference}" 
                                                      CommandParameter="{Binding}"/>
                                        <MenuItem Header="复制" Command="{StaticResource CopyCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="粘贴" Command="{StaticResource PasteCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <MenuItem Header="重命名" Command="{StaticResource RenameCommandReference}" 
                                            CommandParameter="{Binding}"/>
                                        <!--<MenuItem Header="调试信息" Command="{StaticResource DebugCommandReference}" 
                                            CommandParameter="{Binding}" Visibility="Visible"/>-->
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 16,36L 9.99999,36L 9.99999,30L 14,30L 32,16L 32,12L 38,12L 38,18L 34,18L 16,32L 16,36 Z M 34,14L 34,16L 36,16L 36,14L 34,14 Z M 12,32L 12,34L 14,34L 14,32L 12,32 Z " />
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}" Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=false}"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto" Visibility="{Binding EditMode,Converter={StaticResource boolVisibilityConverter},ConverterParameter=true}">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Enter" />
                                            <KeyBinding Key="Esc" Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="Esc" />
                                        </TextBox.InputBindings>
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Visibility,ElementName=renametextbox}" Value="Visible">
                                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=renametextbox}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="LostFocus">
                                                <i:InvokeCommandAction Command="{Binding DataContext.EndRenameCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=UserControl}}" CommandParameter="LostFocus" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Grid>
                            </StackPanel>
                        </HierarchicalDataTemplate> 
                    </TreeView.Resources>
                   
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem" BasedOn="{StaticResource LineTreeViewItem}">
                            <Setter Property="IsSelected" Value="{Binding IsSelected,Mode=TwoWay}" />
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded,Mode=TwoWay}" />
                            <!--<Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource Self}}"
                                           Value="true" />
                                        <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem},
                                                  Path=IsSelected}" Value="False"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Background" Value="Red"/>
                                    <Setter Property="BorderBrush" Value="#ffa5d7f0"/>
                                </MultiDataTrigger>
                            </Style.Triggers>-->

                        </Style>
                        
                    </TreeView.ItemContainerStyle>

                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectedItemChanged">
                            <i:InvokeCommandAction Command="{Binding SelectedTreeChangedComamnd}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="PreviewMouseRightButtonDown">
                            <command:ExInvokeCommandAction Command="{Binding PreviewMouseRightComamnd}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <!--<i:EventTrigger EventName="PreviewMouseDown">
                            <command:ExInvokeCommandAction Command="{Binding MouseDownComamnd}"  CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="MouseMove">
                            <command:ExInvokeCommandAction Command="{Binding MouseMoveComamnd}"  CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="DragEnter">
                            <command:ExInvokeCommandAction Command="{Binding DragEnterCommand}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="DragOver">
                            <command:ExInvokeCommandAction Command="{Binding DragOverCommand}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="DragLeave">
                            <command:ExInvokeCommandAction Command="{Binding DragLeaveCommand}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="Drop">
                            <command:ExInvokeCommandAction Command="{Binding DropCommand}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>-->
                    </i:Interaction.Triggers>

                </TreeView>
                <GridSplitter Grid.Row="1" Height="3" Background="{DynamicResource AccentColorBrush}" HorizontalAlignment="Stretch" VerticalAlignment="Center" />
                <TreeView Name="treeview2" Grid.Row="2"                        
                        ItemsSource="{Binding RecycledTreeItems}" 
                        Style="{DynamicResource VirtualisedMetroTreeView}">
                    <!--<TreeView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="清空回收站" Command="{StaticResource ClearRecycledCommandReference}" CommandParameter="-1"/>
                        </ContextMenu>
                    </TreeView.ContextMenu>-->
                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type control:OrganizationTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <Path x:Name="IconPath" Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 25.3333,23.75L 50.6667,23.75C 51.5411,23.75 51.8541,27.3125 51.8541,27.3125L 24.1458,27.3125C 24.1458,27.3125 24.4589,23.75 25.3333,23.75 Z M 35.625,19.7917L 40.375,19.7917C 40.8122,19.7917 41.9583,20.9378 41.9583,21.375C 41.9583,21.8122 40.8122,22.9584 40.375,22.9584L 35.625,22.9584C 35.1878,22.9584 34.0416,21.8122 34.0416,21.375C 34.0416,20.9378 35.1878,19.7917 35.625,19.7917 Z M 27.7083,28.5L 48.2916,28.5C 49.1661,28.5 49.875,29.2089 49.875,30.0834L 48.2916,53.8334C 48.2916,54.7078 47.5828,55.4167 46.7083,55.4167L 29.2917,55.4167C 28.4172,55.4167 27.7083,54.7078 27.7083,53.8334L 26.125,30.0834C 26.125,29.2089 26.8339,28.5 27.7083,28.5 Z M 30.0833,31.6667L 30.4792,52.25L 33.25,52.25L 32.8542,31.6667L 30.0833,31.6667 Z M 36.4167,31.6667L 36.4167,52.25L 39.5833,52.25L 39.5833,31.6667L 36.4167,31.6667 Z M 43.1458,31.6667L 42.75,52.25L 45.5208,52.25L 45.9167,31.6667L 43.1458,31.6667 Z "/>
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}"  Width="Auto"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto"  Visibility="Collapsed"/>
                                </Grid>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type control:ItemTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="恢复到所选测点" Command="{StaticResource RecoveredItemCommandReference}" 
                                                      CommandParameter="{Binding}"/>
                                        <!--<MenuItem Header="调试信息" Command="{StaticResource DebugCommandReference}" 
                                            CommandParameter="{Binding}" Visibility="Visible"/>-->
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 11,12L 13,12L 13,34L 37,34L 37,36L 11,36L 11,12 Z M 14,33L 14,30L 20,23L 29,27L 37,13L 37,17L 30,30L 20,26L 14,33 Z " />
                                <Grid Margin="2,0,2,0">
                                    <TextBlock Text="{Binding Name, Mode=TwoWay}"  Width="Auto"/>
                                    <TextBox x:Name="renametextbox" Text="{Binding Name, Mode=TwoWay}" Background="Transparent" Foreground="White"  
                                        Width="Auto"  Visibility="Collapsed" />
                                </Grid>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>

                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem" BasedOn="{StaticResource LineTreeViewItem}">
                            <Setter Property="IsSelected" Value="{Binding IsSelected,Mode=TwoWay}" />
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded,Mode=TwoWay}" />
                        </Style>
                    </TreeView.ItemContainerStyle>

                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectedItemChanged">
                            <i:InvokeCommandAction Command="{Binding SelectedTreeChangedComamnd}" CommandParameter="{Binding SelectedItem, ElementName=treeview}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="PreviewMouseRightButtonDown">
                            <command:ExInvokeCommandAction Command="{Binding PreviewMouseRightComamnd}" CommandParameter="{Binding ElementName=treeview}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                       
                    
                </TreeView>
            </Grid>
        </Grid>

        <GridSplitter Grid.Column="1" Grid.Row="1" Width="3" Background="{DynamicResource AccentColorBrush}" HorizontalAlignment="Center" VerticalAlignment="Stretch" />

        <Grid Grid.Column="2" Grid.Row="1">
            <TreeView x:Name="serverview" 
                      ItemsSource="{Binding ServerTreeItems}" 
                      Style="{DynamicResource VirtualisedMetroTreeView}">
                <TreeView.Resources>
                    <HierarchicalDataTemplate DataType="{x:Type control:ServerTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 38,19C 47.3888,19 55,21.0147 55,23.5038L 55,25.5C 55,27.9853 47.3888,30 38,30C 28.6112,30 21,27.9853 21,25.5L 21,23.5C 21,21.0147 28.6112,19 38,19 Z M 55,52.5C 55,54.9853 47.3888,57 38,57C 28.6112,57 21,54.9853 21,52.5L 21,46.5C 21,48.9853 28.6112,51 38,51C 47.384,51 54.9921,48.9874 55,46.5039L 55,52.5 Z M 55,43.5C 55,45.9853 47.3888,48 38,48C 28.6112,48 21,45.9853 21,43.5L 21,37.5C 21,39.9853 28.6112,42 38,42C 47.384,42 54.9921,39.9874 55,37.5038L 55,43.5 Z M 55,34.5C 55,36.9853 47.3888,39 38,39C 28.6112,39 21,36.9853 21,34.5L 21,28.5C 21,30.9853 28.6112,33 38,33C 47.384,33 54.9921,30.9874 55,28.5038L 55,34.5 Z "/>
                            <TextBlock Text="服务器" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text=":" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding ServerIP}" VerticalAlignment="Center" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:MainCardTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="删除数采器" Command="{StaticResource DeleteCardCommandReference}" 
                                                      CommandParameter="{Binding}"/>
                                    <MenuItem Header="强制删除数采器" Command="{StaticResource ForceDeleteCardCommandReference}" 
                                                      CommandParameter="{Binding}"/>
                                </ContextMenu>
                            </StackPanel.ContextMenu>
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 21.3,17L 46.7,17C 47.418,17 48,17.5821 48,18.3L 48,24.7C 48,25.418 47.418,26 46.7,26L 31.3,26C 30.0298,26 29,27.0298 29,28.3L 29,49.7C 29,50.418 28.418,51 27.7,51L 21.3,51C 20.582,51 20,50.418 20,49.7L 20,18.3C 20,17.582 20.582,17 21.3,17 Z M 33.3,29L 54.7,29C 55.418,29 56,29.582 56,30.3L 56,57.7C 56,58.418 55.418,59 54.7,59L 33.3,59C 32.582,59 32,58.418 32,57.7L 32,30.3C 32,29.582 32.582,29 33.3,29 Z "/>
                            <TextBlock Text="主板:" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text="{Binding MainControlCardIP, Mode=TwoWay}" VerticalAlignment="Center" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:WireMatchingCardTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 38,15.8334L 58.5833,23.75L 58.5833,30.0833L 38,38L 17.4167,30.0833L 17.4166,23.75L 38,15.8334 Z M 58.5833,44.3333L 58.5833,52.25L 38,60.1667L 17.4167,52.25L 17.4167,44.3333L 21.5333,45.9167L 38,52.25L 54.4667,45.9167L 58.5833,44.3333 Z M 58.5833,33.25L 58.5833,41.1667L 38,49.0833L 17.4167,41.1667L 17.4167,33.25L 21.5333,34.8333L 38,41.1667L 54.4666,34.8333L 58.5833,33.25 Z "/>
                            <TextBlock Text="板卡" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text="{Binding CardNum,Converter={StaticResource intAdd1Converter}}" VerticalAlignment="Center"/>
                            <TextBlock Text=":" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:WirelessReceiveCardTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 38,27.1542C 43.99,27.1542 48.8458,32.01 48.8458,38C 48.8458,43.99 43.99,48.8458 38,48.8458C 32.01,48.8458 27.1542,43.99 27.1542,38C 27.1542,32.01 32.01,27.1542 38,27.1542 Z M 38,16.625C 49.8051,16.625 59.375,26.1949 59.375,38C 59.375,49.8051 49.8051,59.375 38,59.375C 26.1949,59.375 16.625,49.8051 16.625,38C 16.625,26.1949 26.1949,16.625 38,16.625 Z M 38,20.5833C 28.381,20.5833 20.5833,28.381 20.5833,38C 20.5833,47.619 28.381,55.4167 38,55.4167C 47.6189,55.4167 55.4167,47.619 55.4167,38C 55.4167,28.381 47.619,20.5833 38,20.5833 Z "/>
                            <TextBlock Text="无线接收板" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <!--<TextBlock Text=":" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding MasterIdentifier}" VerticalAlignment="Center" />-->
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:TransmissionCardTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 36.4167,19C 44.2867,19 50.6667,24.6711 50.6667,31.6667C 50.6667,32.7601 50.5108,33.8212 50.2177,34.8333L 36.4167,57L 22.6156,34.8333C 22.3225,33.8212 22.1667,32.7601 22.1667,31.6667C 22.1667,24.6711 28.5466,19 36.4167,19 Z M 36.4167,27.7083C 34.2305,27.7083 32.4583,29.4805 32.4583,31.6667C 32.4583,33.8528 34.2305,35.625 36.4167,35.625C 38.6028,35.625 40.375,33.8528 40.375,31.6667C 40.375,29.4805 38.6028,27.7083 36.4167,27.7083 Z "/>
                            <TextBlock Text="传输卡" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text=":" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SlaveIdentifier}" VerticalAlignment="Center" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:SlotTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="16" Height="16" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 19,23L 27,23L 27,31L 19,31L 19,23 Z M 19,34L 27,34L 27,42L 19,42L 19,34 Z M 31,23L 57,23L 57,31L 31,31L 31,23 Z M 19,45L 27,45L 27,53L 19,53L 19,45 Z M 31,34L 57,34L 57,42L 31,42L 31,34 Z M 31,45L 57,45L 57,53L 31,53L 31,45 Z "/>
                            <TextBlock Text="槽" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text="{Binding SlotNum,Converter={StaticResource intAdd1Converter}}" VerticalAlignment="Center" />
                            <!--<TextBlock Text=":" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center" />-->
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type control:ChannelTreeItemViewModel}" ItemsSource="{Binding Path=Children}" >
                        <StackPanel Orientation="Horizontal">
                            <Path Width="18" Height="18" Stretch="Fill" Fill="{DynamicResource AccentColorBrush}" Data="F1 M 44.4832,15.8147L 38.0245,32.9939L 37.8017,32.9939L 31.6771,15.8147L 21.7662,21.578L 33.4588,35.6539L 33.4588,35.8755L 16.087,32.3289L 16.087,43.523L 33.5702,40.4197L 33.6815,40.6414L 21.7662,54.4955L 31.343,60.148L 37.6904,43.0797L 37.9131,43.0797L 44.3718,60.148L 54.1713,54.4955L 42.1447,40.7522L 42.1447,40.5305L 60.0713,43.523L 60.0713,32.3289L 42.256,35.8755L 42.256,35.6539L 54.1713,21.4672L 44.4832,15.8147 Z "/>
                            <TextBlock Text="通道" VerticalAlignment="Center" Margin="2,0,0,0"/>
                            <TextBlock Text="{Binding CHNum,Converter={StaticResource intAdd1Converter}}" VerticalAlignment="Center"/>
                            <Button x:Name="BindBtn" Width="24" Height="24" 
                                     Command="{Binding RelativeSource={RelativeSource FindAncestor,  AncestorType={x:Type TreeView}},  Path=DataContext.BindChannelCommand}" CommandParameter="{Binding}">
                                <Path x:Name="StatusPath" Width="18" Height="18" Stretch="Fill" Fill="Green" Data="F1 M 14.002,23.0031L 16.0021,23.0031L 16.0021,20.0028C 16.0021,15.5839 19.5843,12.0017 24.0032,12.0017C 28.4221,12.0017 32.0043,15.5839 32.0043,20.0028L 29.0039,20.0028C 29.0039,17.241 26.765,15.0021 24.0032,15.0021C 21.2414,15.0021 19.0025,17.241 19.0025,20.0028L 19.0025,23.0031L 34.0047,23.0031L 34.0047,36.005L 14.002,36.005L 14.002,23.0031 Z "  />
                            </Button>
                        </StackPanel>
                        <HierarchicalDataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsPaired}" Value="True">
                                <Setter TargetName="StatusPath" Property="Data" Value="F1 M 14.0021,23.0031L 16.0022,23.0031L 16.0022,20.0028C 16.0022,15.5839 19.5845,12.0017 24.0033,12.0017C 28.4222,12.0017 32.0045,15.5839 32.0045,20.0028L 32.0045,23.0031L 34.0049,23.0031L 34.0049,36.005L 14.0021,36.005L 14.0021,23.0031 Z M 29.004,20.0028C 29.004,17.241 26.7652,15.0021 24.0033,15.0021C 21.2415,15.0021 19.0026,17.241 19.0026,20.0028L 19.0026,23.0031L 29.004,23.0031L 29.004,20.0028 Z " />
                                <Setter TargetName="StatusPath" Property="Fill" Value="Red" />
                            </DataTrigger>
                        </HierarchicalDataTemplate.Triggers>
                    </HierarchicalDataTemplate> 
                 
                </TreeView.Resources>

                <TreeView.ItemContainerStyle>
                    <Style TargetType="TreeViewItem" BasedOn="{StaticResource LineTreeViewItem}">
                        <Setter Property="IsSelected" Value="{Binding IsSelected,Mode=TwoWay}" />
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded,Mode=TwoWay}" />
                    </Style>
                </TreeView.ItemContainerStyle>

                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectedItemChanged">
                        <i:InvokeCommandAction Command="{Binding SelectedServerChangedComamnd}" CommandParameter="{Binding SelectedItem, ElementName=serverview}"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="PreviewMouseRightButtonDown">
                        <command:ExInvokeCommandAction Command="{Binding PreviewMouseRightComamnd}" CommandParameter="{Binding ElementName=treeview}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>

                 
             

            </TreeView>
        </Grid>

        <GridSplitter Grid.Column="3" Grid.Row="1" Width="3" Background="{DynamicResource AccentColorBrush}" HorizontalAlignment="Center" VerticalAlignment="Stretch" />

        <Grid Grid.Column="4" Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="158"/>
                <RowDefinition Height="*"/>                
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="332"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <ListView Grid.Row="0" x:Name="listMainCard" ItemsSource="{Binding MainCard}" ItemContainerStyle="{StaticResource UnSelectedListViewItem}" Margin="0,0,0,75" Grid.RowSpan="2">
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Width="{Binding ActualWidth,RelativeSource={RelativeSource AncestorType={x:Type ListView}}}"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseDoubleClick">
                        <i:InvokeCommandAction Command="{Binding CardEditCommand}" CommandParameter="{Binding SelectedItem, ElementName=listMainCard}"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="SelectionChanged">
                        <i:InvokeCommandAction Command="{Binding CardChangedCommand}" CommandParameter="{Binding SelectedItem, ElementName=listMainCard}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </ListView>
            <ListView Grid.Row="0" Grid.Column="1" x:Name="listWirelessReceiveCard" ItemsSource="{Binding WirelessReceiveCard}" ItemContainerStyle="{StaticResource UnSelectedListViewItem}" Margin="0,0,0,75" Grid.RowSpan="2">
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Width="{Binding ActualWidth,RelativeSource={RelativeSource AncestorType={x:Type ListView}}}"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseDoubleClick">
                        <i:InvokeCommandAction Command="{Binding CardEditCommand}" CommandParameter="{Binding SelectedItem, ElementName=listWirelessReceiveCard}"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="SelectionChanged">
                        <i:InvokeCommandAction Command="{Binding CardChangedCommand}" CommandParameter="{Binding SelectedItem, ElementName=listWirelessReceiveCard}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </ListView>
            <ListView Grid.Row="1" Grid.ColumnSpan="2" x:Name="listCard" SelectedItem="{Binding SelectedCard}" ItemsSource="{Binding Cards}" ItemContainerStyle="{StaticResource ListViewItemStyle}" Grid.RowSpan="2" >
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Width="{Binding ActualWidth,RelativeSource={RelativeSource AncestorType={x:Type ListView}}}"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseDoubleClick">
                        <i:InvokeCommandAction Command="{Binding CardEditCommand}" CommandParameter="{Binding SelectedItem, ElementName=listCard}"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="SelectionChanged">
                        <i:InvokeCommandAction Command="{Binding CardChangedCommand}" CommandParameter="{Binding SelectedItem, ElementName=listCard}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </ListView>
        </Grid>

        <ListView x:Name="listSlot" SelectedItem="{Binding SelectedSlot}" ItemsSource="{Binding Slots}" Grid.Column="5" Grid.Row="1" ItemContainerStyle="{StaticResource ListViewItemStyle}">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding SlotEditCommand}" CommandParameter="{Binding SelectedItem, ElementName=listSlot}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding SlotChangedComamnd}" CommandParameter="{Binding SelectedItem, ElementName=listSlot}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </ListView>

        <ListView x:Name="listChannel" SelectedItem="{Binding SelectedChannel}" ItemsSource="{Binding Channels}" Grid.Column="6" Grid.Row="1" AllowDrop="{Binding AllowDropList}" SelectionMode="Single" ItemContainerStyle="{StaticResource ListViewItemStyle}">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding ChannelEditCommand}" CommandParameter="{Binding SelectedItem, ElementName=listChannel}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding ChannelChangedCommand}" CommandParameter="{Binding SelectedItem, ElementName=listChannel}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </ListView>
    </Grid>
</UserControl>
